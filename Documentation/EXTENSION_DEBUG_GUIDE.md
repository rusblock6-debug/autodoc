# Диагностика расширения НИР-Документ

## Проблема
Расширение создает пустые гайды без шагов. Сообщение "Нет руководств" появляется вместо созданного контента.

## Статус исправлений
✅ **API работает** - endpoints отвечают корректно  
✅ **База данных исправлена** - добавлены колонки `is_favorite`, `is_public`  
✅ **Docker контейнеры запущены** - все сервисы работают  

## Пошаговая диагностика

### 1. Проверка установки расширения
1. Откройте Chrome
2. Перейдите в `chrome://extensions/`
3. Включите "Режим разработчика"
4. Нажмите "Загрузить распакованное расширение"
5. Выберите папку `extension/`
6. Убедитесь, что расширение активно

### 2. Проверка консоли расширения
1. В `chrome://extensions/` найдите "НИР-Документ"
2. Нажмите "Подробности" → "Проверить представления: service worker"
3. Откроется консоль background script
4. Проверьте, есть ли ошибки

### 3. Тестирование записи
1. Нажмите на иконку расширения
2. Введите название: "Тест записи"
3. Нажмите "Начать запись"
4. Разрешите захват экрана
5. **ВАЖНО:** Сделайте несколько кликов на странице
6. Нажмите "Остановить"

### 4. Проверка логов
В консоли background script должны появиться сообщения:
```
[НИР-Документ] Background script loaded
[НИР-Документ] Recording STARTED
[НИР-Документ] Click #1: BUTTON at 100,200
[НИР-Документ] Screenshot #1 OK
[НИР-Документ] Session: 3 clicks, 1 navigations
[НИР-Документ] Upload success
```

### 5. Проверка API
Если расширение не работает, проверьте API напрямую:
```bash
# Проверка здоровья
curl http://localhost:8000/health

# Проверка сессий
curl http://localhost:8000/api/v1/sessions

# Проверка гайдов  
curl http://localhost:8000/api/v1/guides
```

## Возможные проблемы

### Проблема 1: Нет кликов
**Симптом:** Гайд создается, но без шагов  
**Причина:** Пользователь не кликал во время записи  
**Решение:** Обязательно делайте клики после начала записи

### Проблема 2: CORS ошибки
**Симптом:** Ошибки в консоли про CORS  
**Причина:** Неправильная конфигурация API  
**Решение:** Проверить настройки CORS в `app/main.py`

### Проблема 3: Неправильный URL API
**Симптом:** Ошибки сети в консоли  
**Причина:** API недоступен на localhost:8000  
**Решение:** Проверить, что Docker контейнеры запущены

### Проблема 4: Кодировка
**Симптом:** Кракозябры в названиях  
**Причина:** Проблемы с UTF-8  
**Решение:** Использовать английские названия для тестов

## Быстрое решение

Если ничего не помогает:

1. **Перезапустите Docker:**
```bash
docker-compose down
docker-compose up -d
```

2. **Переустановите расширение:**
   - Удалите из Chrome
   - Загрузите заново из папки `extension/`

3. **Очистите данные:**
```bash
# Очистка базы данных
docker exec -it autodoc-postgres psql -U autodoc -d autodoc_db -c "TRUNCATE guides, guide_steps, recording_sessions CASCADE;"
```

## Контакты для отладки
- API: http://localhost:8000/docs
- Frontend: http://localhost:3000  
- MinIO: http://localhost:9001
- pgAdmin: http://localhost:5050