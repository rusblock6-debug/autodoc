# –û—Ç—á–µ—Ç –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö Docker-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

## üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤ Development Dockerfile**

**–ü—Ä–æ–±–ª–µ–º–∞:** –í `Dockerfile` –¥–ª—è stage `development` (—Å—Ç—Ä–æ–∫–∏ 79-94) –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø–∞–∫–µ—Ç—ã, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

- ‚ùå **FFmpeg** - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–µ–Ω –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–∏–¥–µ–æ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `video_processor.py`, `screenshot_service.py`, `shorts_generator.py`)
- ‚ùå **libsm6, libxext6, libxrender1** - –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã –¥–ª—è OpenCV –∏ —Ä–∞–±–æ—Ç—ã —Å –≥—Ä–∞—Ñ–∏–∫–æ–π
- ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç build-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö Python –ø–∞–∫–µ—Ç–æ–≤

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —Å–º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤–∏–¥–µ–æ
- –û—à–∏–±–∫–∏ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ `opencv-python`
- –û—à–∏–±–∫–∏ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å `moviepy`

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤ development stage.

---

### 2. **–ö–æ–Ω—Ñ–ª–∏–∫—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ llama-cpp-python**

**–ü—Ä–æ–±–ª–µ–º–∞:** 
- –í `requirements.txt` (—Å—Ç—Ä–æ–∫–∞ 35) `llama-cpp-python>=0.2.57` **–Ω–µ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω**
- –í `Dockerfile` (—Å—Ç—Ä–æ–∫–∞ 31) –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ—Ç–¥–µ–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å CUDA —Ñ–ª–∞–≥–∞–º–∏: `CMAKE_ARGS="-DLLAMA_CUBLAS=ON" pip install --no-cache-dir --force-reinstall llama-cpp-python`

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –î–≤–æ–π–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–∞ (—Å–Ω–∞—á–∞–ª–∞ –∏–∑ requirements.txt –±–µ–∑ CUDA, –ø–æ—Ç–æ–º —Å CUDA)
- –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ —Å–±–æ—Ä–∫–∏
- –í–æ–∑–º–æ–∂–Ω—ã–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –≤–µ—Ä—Å–∏–π

**–†–µ—à–µ–Ω–∏–µ:** –õ–∏–±–æ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ requirements.txt, –ª–∏–±–æ —É–±—Ä–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é —É—Å—Ç–∞–Ω–æ–≤–∫—É –∏–∑ Dockerfile.

---

### 3. **–ü—Ä–æ–±–ª–µ–º–∞ —Å Healthcheck –≤ Dockerfile**

**–ü—Ä–æ–±–ª–µ–º–∞:** –í production stage (—Å—Ç—Ä–æ–∫–∞ 72) healthcheck –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Python one-liner:
```dockerfile
CMD python -c "import urllib.request; urllib.request.urlopen('http://localhost:8000/health')" || exit 1
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ú–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
- –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –ú–æ–∂–µ—Ç –ø–∞–¥–∞—Ç—å –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–∞

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `curl` –∏–ª–∏ `wget`, –ª–∏–±–æ –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω—ã–π Python —Å–∫—Ä–∏–ø—Ç.

---

### 4. **MinIO Healthcheck –≤ docker-compose.yml**

**–ü—Ä–æ–±–ª–µ–º–∞:** –í `docker-compose.yml` (—Å—Ç—Ä–æ–∫–∞ 84) healthcheck –¥–ª—è MinIO –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `curl`:
```yaml
test: ["CMD", "curl", "-f", "http://localhost:9000/minio/health/live"]
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –û–±—Ä–∞–∑ `minio/minio:latest` –º–æ–∂–µ—Ç –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç—å `curl`
- Healthcheck –±—É–¥–µ—Ç –ø–∞–¥–∞—Ç—å

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –∫–æ–º–∞–Ω–¥—É MinIO –∏–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å curl –≤ –æ–±—Ä–∞–∑.

---

## ‚ö†Ô∏è –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 5. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ GPU runtime –¥–ª—è Production**

**–ü—Ä–æ–±–ª–µ–º–∞:** Production stage –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `nvidia/cuda:12.2-runtime-ubuntu22.04`, —á—Ç–æ —Ç—Ä–µ–±—É–µ—Ç:
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ NVIDIA Docker runtime
- GPU –Ω–∞ —Ö–æ—Å—Ç–µ
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Docker daemon

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ù–∞ —Å–∏—Å—Ç–µ–º–∞—Ö –±–µ–∑ GPU –∏–ª–∏ –±–µ–∑ nvidia-docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è
- –û—à–∏–±–∫–∏ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å CUDA

**–†–µ—à–µ–Ω–∏–µ:** –°–¥–µ–ª–∞—Ç—å GPU –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å CPU-only –≤–∞—Ä–∏–∞–Ω—Ç.

---

### 6. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ .dockerignore**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç —Ñ–∞–π–ª–∞ `.dockerignore`, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫:
- –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—é –Ω–µ–Ω—É–∂–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ (__pycache__, .git, node_modules –∏ —Ç.–¥.)
- –£–≤–µ–ª–∏—á–µ–Ω–∏—é —Ä–∞–∑–º–µ—Ä–∞ –æ–±—Ä–∞–∑–∞
- –ú–µ–¥–ª–µ–Ω–Ω–æ–π —Å–±–æ—Ä–∫–µ

---

### 7. **–†–∞–∑–Ω—ã–µ –±–∞–∑–æ–≤—ã–µ –æ–±—Ä–∞–∑—ã –¥–ª—è Production –∏ Development**

**–ü—Ä–æ–±–ª–µ–º–∞:**
- Production: `nvidia/cuda:12.2-devel-ubuntu22.04` (Ubuntu 22.04)
- Development: `python:3.10-slim` (Debian-based)

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –†–∞–∑–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –≤ —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è—Ö
- –†–∞–∑–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫
- –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

---

### 8. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è MinIO –≤ celery-worker**

**–ü—Ä–æ–±–ª–µ–º–∞:** –í `docker-compose.yml` –¥–ª—è `celery-worker` (—Å—Ç—Ä–æ–∫–∏ 100-109) –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç:
- `MINIO_ACCESS_KEY`
- `MINIO_SECRET_KEY`

–•–æ—Ç—è –æ–Ω–∏ –µ—Å—Ç—å –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Å–µ—Ä–≤–∏—Å–µ `autodoc-ai`.

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- Celery worker –º–æ–∂–µ—Ç –Ω–µ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ MinIO
- –û—à–∏–±–∫–∏ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º

---

## üìã –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–ö—Ä–∏—Ç–∏—á–Ω–æ):
1. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É FFmpeg –∏ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫ –≤ development stage
2. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç llama-cpp-python (–∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ requirements.txt)
3. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å healthcheck –¥–ª—è MinIO
4. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è celery-worker

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–í–∞–∂–Ω–æ):
5. ‚úÖ –£–ª—É—á—à–∏—Ç—å healthcheck –≤ Dockerfile
6. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å .dockerignore
7. ‚úÖ –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—ã–µ –æ–±—Ä–∞–∑—ã –∏–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–ª–∏—á–∏—è

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ):
8. ‚úÖ –°–¥–µ–ª–∞—Ç—å GPU –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º
9. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å multi-stage build –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

---

## üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

- –í `docker-compose.yml` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `target: development`, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —É–ø—Ä–æ—â–µ–Ω–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞ –±–µ–∑ GPU
- –î–ª—è production —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `target: production`, –Ω–æ —ç—Ç–æ —Ç—Ä–µ–±—É–µ—Ç NVIDIA Docker runtime
- –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–≤–∏—Å—è—Ç –æ—Ç —Å–µ—Ç–∏ `autodoc-network`, —á—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
